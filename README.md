# Документация базы данных `crypto_db`

## Описание проекта
База данных `crypto_db` предназначена для управления учебными курсами по криптографии. Она включает функционал для:
- Регистрации пользователей (студенты, преподаватели, администраторы).
- Создания курсов, тем и учебных материалов.
- Проведения тестов и отслеживания прогресса учащихся.
- Управления заявками и достижениями пользователей.

---

## Структура базы данных

### Таблицы

#### 1. **users** (Пользователи)
| Поле             | Тип данных       | Описание                           |
|-------------------|------------------|------------------------------------|
| `id`             | SERIAL          | Уникальный идентификатор           |
| `email`          | VARCHAR(255)    | Email (уникальный)                 |
| `password_hash`  | VARCHAR(255)    | Хэш пароля (bcrypt/scrypt)         |
| `role`           | VARCHAR(20)     | Роль: student, teacher, admin      |
| `avatar_url`     | VARCHAR(255)    | Ссылка на аватар                   |
| `created_at`     | TIMESTAMP       | Дата регистрации (по умолчанию NOW)|

---

#### 2. **courses** (Курсы)
| Поле             | Тип данных       | Описание                           |
|-------------------|------------------|------------------------------------|
| `id`             | SERIAL          | Уникальный идентификатор           |
| `title`          | VARCHAR(255)    | Название курса                     |
| `description`    | TEXT            | Описание курса                     |
| `created_by`     | INT             | ID создателя (внешний ключ на users)|
| `created_at`     | TIMESTAMP       | Дата создания (по умолчанию NOW)   |

---

#### 3. **topics** (Темы)
| Поле             | Тип данных       | Описание                           |
|-------------------|------------------|------------------------------------|
| `id`             | SERIAL          | Уникальный идентификатор           |
| `course_id`      | INT             | ID курса (внешний ключ на courses) |
| `parent_topic_id`| INT             | ID родительской темы (рекурсивная связь) |
| `title`          | VARCHAR(255)    | Название темы                      |
| `description`    | TEXT            | Описание темы                      |
| `order_num`      | INT             | Порядок в курсе (начинается с 1)   |

---

#### 4. **materials** (Материалы)
| Поле             | Тип данных       | Описание                           |
|-------------------|------------------|------------------------------------|
| `id`             | SERIAL          | Уникальный идентификатор           |
| `topic_id`       | INT             | ID темы (внешний ключ на topics)   |
| `type`           | VARCHAR(20)     | Тип: text, video, file             |
| `content_json`   | JSONB           | Текст в формате JSON (например, Markdown) |
| `content_url`    | VARCHAR(255)    | Путь к файлу (видео/документ)      |
| `order_num`      | INT             | Порядок в теме (начинается с 1)    |

---

#### Полный список таблиц:
- `tests` (Тесты)
- `questions` (Вопросы)
- `test_results` (Результаты тестов)
- `user_progress` (Прогресс пользователей)
- `achievements` (Достижения)
- `user_achievements` (Достижения пользователей)
- `requests` (Заявки)
- `user_terms` (Словарь терминов)

---

## Установка

### 1. Требования
- PostgreSQL 14+
- Пользователь `crypto_user` с правами на создание таблиц.

### 2. Восстановление базы данных
```bash
# Создать базу данных
sudo -u postgres psql -c "CREATE DATABASE crypto_db;"

# Восстановить схему
psql -U crypto_user -d crypto_db -f schema.sql

# Загрузить тестовые данные (опционально)
psql -U crypto_user -d crypto_db -f data_dump.sql
